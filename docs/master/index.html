<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Swindler  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="Swindler  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          Swindler Docs
        </a>
         (47% documented)
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/tmandry/Swindler">
            <img class="header-icon" src="img/gh.png"/>
            View on GitHub
          </a>
        </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="dash-feed://https%3A%2F%2Ftmandry%2Egithub%2Eio%2FSwindler%2Fdocs%2Fdocsets%2FSwindler%2Exml">
            <img class="header-icon" src="img/dash.png"/>
            Install in Dash
          </a>
        </p>
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">Swindler Reference</a>
      <img class="carat" src="img/carat.png" />
      Swindler  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="System.html">System</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="System.html#/s:8Swindler10initialize10PromiseKit0C0CyAA5StateCGyF">initialize()</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/State.html">State</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Application.html">Application</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Window.html">Window</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Screen.html">Screen</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Properties.html">Properties</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Property.html">Property</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/WriteableProperty.html">WriteableProperty</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/PropertyError.html">PropertyError</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Fakes.html">Fakes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/FakeState.html">FakeState</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/FakeApplication.html">FakeApplication</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/FakeWindow.html">FakeWindow</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/FakeScreen.html">FakeScreen</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/FakeWindowBuilder.html">FakeWindowBuilder</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Events.html">Events</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ApplicationFocusedWindowChangedEvent.html">ApplicationFocusedWindowChangedEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ApplicationIsHiddenChangedEvent.html">ApplicationIsHiddenChangedEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ApplicationLaunchedEvent.html">ApplicationLaunchedEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ApplicationMainWindowChangedEvent.html">ApplicationMainWindowChangedEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ApplicationTerminatedEvent.html">ApplicationTerminatedEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/FrontmostApplicationChangedEvent.html">FrontmostApplicationChangedEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ScreenLayoutChangedEvent.html">ScreenLayoutChangedEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/WindowCreatedEvent.html">WindowCreatedEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/WindowDestroyedEvent.html">WindowDestroyedEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/WindowMinimizedChangedEvent.html">WindowMinimizedChangedEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/WindowPosChangedEvent.html">WindowPosChangedEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/WindowSizeChangedEvent.html">WindowSizeChangedEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/WindowTitleChangedEvent.html">WindowTitleChangedEvent</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other Functions.html">Other Functions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Other Functions.html#/s:8Swindler2eeoiSbAA10FakeWindowC_ADtF">==(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Other Functions.html#/s:8Swindler2eeoiSbAA11ApplicationC_ADtF">==(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Other Functions.html#/s:8Swindler2eeoiSbAA15FakeApplicationC_ADtF">==(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Other Functions.html#/s:8Swindler2eeoiSbAA6ScreenC_ADtF">==(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Other Functions.html#/s:8Swindler2eeoiSbAA6WindowC_ADtF">==(_:_:)</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other Protocols.html">Other Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/EventType.html">EventType</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other Structs.html">Other Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/OfOptionalType.html">OfOptionalType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/OfType.html">OfType</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content">
            
            <h1 id='swindler' class='heading'>Swindler</h1>

<p><em>A Swift window management library for macOS</em></p>

<p><a href="https://travis-ci.org/tmandry/Swindler"><img src="https://travis-ci.org/tmandry/Swindler.svg?branch=master" alt="Build Status"></a>
<a href="https://gitter.im/tmandry/Swindler?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge"><img src="https://badges.gitter.im/tmandry/Swindler.svg" alt="Join the chat at https://gitter.im/tmandry/Swindler"></a></p>

<p>In the past few years, many developers formerly on Linux and Windows have migrated to Mac for their
excellent hardware and UNIX-based OS that <q>just works</q>.</p>

<p>But along the way we gave up something dear to us: control over our desktop environment.</p>

<p><strong>The goal of Swindler is to help us take back that control</strong>, and give us the best of both worlds.</p>
<h2 id='what-swindler-does' class='heading'>What Swindler Does</h2>

<p>Writing window managers for macOS is hard. There are a lot of systemic challenges, including limited
and poorly-documented APIs. All window managers on macOS must use the C-based accessibility APIs, which
are difficult to use and are surprisingly buggy themselves.</p>

<p>As a result, the selection of window managers is pretty limited, and many of the ones out there have
annoying bugs, like freezes, race conditions, <q>phantom windows</q>, and not <q>seeing</q> windows that are
actually there. The more sophisticated the window manager is, the more it relies on these APIs and
the more these bugs start to show up.</p>

<p>Swindler&rsquo;s job is to make it easy to write powerful window managers using a well-documented Swift
API and abstraction layer. It addresses the problems of the accessibility API with these features:</p>
<h3 id='type-safety' class='heading'>Type safety</h3>

<p><a href="https://github.com/tmandry/Swindler/blob/master/API.swift">Swindler&rsquo;s API</a> is
fully documented and type-safe thanks to Swift. It&rsquo;s much easier and safer to use than the C-based
accessibility APIs. (See the example below.)</p>
<h3 id='in-memory-model' class='heading'>In-memory model</h3>

<p>Window managers on macOS rely on IPC: you <em>ask</em> an application for a window&rsquo;s position, <em>wait</em> for it
to respond, <em>request</em> that it be moved or focused, then <em>wait</em> for the application to comply (or
not). Most of the time this works okay, but it works at the mercy of the remote application&rsquo;s event
loop, which can lead to long, multi-second delays.</p>

<p>Swindler maintains a model of all applications and window states, so your code knows everything
about the windows on the screen. <strong>Reads are instantaneous</strong>, because all state is cached within your
application&rsquo;s process and stays up to date. Swindler is extensively tested to ensure it stays
consistent with the system in any situation.</p>
<h3 id='asynchronous-writes-and-refreshes' class='heading'>Asynchronous writes and refreshes</h3>

<p>If you need to resize a lot of windows simultaneously, for example, you can do so without fear of
one unresponsive application holding everything else up. Write requests are dispatched
asynchronously and concurrently, and Swindler&rsquo;s promise-based API makes it easy to keep up with the
state of operations.</p>
<h3 id='friendly-events' class='heading'>Friendly events</h3>

<p>More sophisticated window managers have to observe events on windows, but the observer API is
not well documented and often leaves out events you might expect, or delivers them in the wrong order.
For example, the following situation is common when a new window pops up:</p>
<pre class="highlight plaintext"><code>1. MainWindowChanged on com.google.chrome to &lt;window1&gt;
2. WindowCreated on com.google.chrome: &lt;window1&gt;
</code></pre>

<p>See the problem? With Swindler, all events are emitted in the expected order, and missing ones are
filled in. Swindler&rsquo;s in-memory state will always be consistent with itself and with the events you
receive, avoiding many bugs that are difficult to diagnose.</p>

<p>As a bonus, <strong>events caused by your code are marked</strong> as such, so you don&rsquo;t respond to them as user
actions. This feature alone makes a whole new level of sophistication possible.</p>
<h2 id='example' class='heading'>Example</h2>

<p>The following code assigns all windows on the screen to a grid. Note the simplicity and power of the
promise-based API. Requests are dispatched concurrently and in the background, not serially.</p>
<pre class="highlight swift"><code><span class="kt">Swindler</span><span class="o">.</span><span class="nf">initialize</span><span class="p">()</span><span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">state</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">screen</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">screens</span><span class="o">.</span><span class="n">first</span><span class="o">!</span>

    <span class="k">let</span> <span class="nv">allPlacedOnGrid</span> <span class="o">=</span> <span class="n">screen</span><span class="o">.</span><span class="n">knownWindows</span><span class="o">.</span><span class="nf">enumerate</span><span class="p">()</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">index</span><span class="p">,</span> <span class="n">window</span> <span class="k">in</span>
        <span class="k">let</span> <span class="nv">rect</span> <span class="o">=</span> <span class="nf">gridRect</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">window</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nf">when</span><span class="p">(</span><span class="n">allPlacedOnGrid</span><span class="p">)</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"all done!"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">gridRect</span><span class="p">(</span><span class="nv">screen</span><span class="p">:</span> <span class="kt">Swindler</span><span class="o">.</span><span class="kt">Screen</span><span class="p">,</span> <span class="nv">index</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">CGRect</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">gridSteps</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">let</span> <span class="nv">position</span>  <span class="o">=</span> <span class="kt">CGSize</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="n">screen</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">gridSteps</span><span class="p">,</span>
                           <span class="nv">height</span><span class="p">:</span> <span class="n">screen</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="n">gridSteps</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">size</span>      <span class="o">=</span> <span class="kt">CGPoint</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="n">gridSize</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="p">(</span><span class="n">index</span> <span class="o">%</span> <span class="n">gridSteps</span><span class="p">),</span>
                            <span class="nv">y</span><span class="p">:</span> <span class="n">gridSize</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="p">(</span><span class="n">index</span> <span class="o">/</span> <span class="n">gridSteps</span><span class="p">))</span>
    <span class="k">return</span> <span class="kt">CGRect</span><span class="p">(</span><span class="nv">origin</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span> <span class="nv">size</span><span class="p">:</span> <span class="n">size</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>Watching for events is simple. Here&rsquo;s how you would implement snap-to-grid:</p>
<pre class="highlight swift"><code><span class="n">swindlerState</span><span class="o">.</span><span class="n">on</span> <span class="p">{</span> <span class="p">(</span><span class="nv">event</span><span class="p">:</span> <span class="kt">WindowMovedEvent</span><span class="p">)</span> <span class="k">in</span>
    <span class="k">guard</span> <span class="n">event</span><span class="o">.</span><span class="n">external</span> <span class="o">==</span> <span class="kc">true</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Ignore events that were caused by us.</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="k">let</span> <span class="nv">snapped</span> <span class="o">=</span> <span class="nf">closestGridPosition</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">event</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">snapped</span>
<span class="p">}</span>
</code></pre>
<h3 id='requesting-permission' class='heading'>Requesting permission</h3>

<p>Your application must request access to the trusted AX API. To do this, simply use
this code in your AppDelegate:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">applicationDidFinishLaunching</span><span class="p">(</span><span class="n">_</span> <span class="nv">aNotification</span><span class="p">:</span> <span class="kt">Notification</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="kt">AXSwift</span><span class="o">.</span><span class="nf">checkIsProcessTrusted</span><span class="p">(</span><span class="nv">prompt</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Not trusted as an AX process; please authorize and re-launch"</span><span class="p">)</span>
        <span class="kt">NSApp</span><span class="o">.</span><span class="nf">terminate</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="c1">// your code here</span>
<span class="p">}</span>
</code></pre>
<h3 id='a-note-on-error-messages' class='heading'>A note on error messages</h3>

<p>Many helper or otherwise <q>special</q>  app components don&rsquo;t respond to the AX requests
or respond with an error. As a result, it&rsquo;s expected to see a number of messages
like this:</p>
<pre class="highlight plaintext"><code>&lt;Debug&gt;: Window &lt;AXUnknown "&lt;AXUIElement 0x610000054eb0&gt; {pid=464}" (pid=464)&gt; has subrole AXUnknown, unwatching
&lt;Debug&gt;: Application invalidated: com.apple.dock
&lt;Debug&gt;: Couldn't initialize window for element &lt;AXUnknown "&lt;AXUIElement 0x610000054eb0&gt; {pid=464}" (pid=464)&gt; () of com.google.Chrome: windowIgnored(&lt;AXUnknown "&lt;AXUIElement 0x610000054eb0&gt; {pid=464}" (pid=464)&gt;)
&lt;Notice&gt;: Could not watch application com.apple.dock (pid=308): invalidObject(AXError.NotificationUnsupported)
&lt;Debug&gt;: Couldn't initialize window for element &lt;AXScrollArea "&lt;AXUIElement 0x61800004ed90&gt; {pid=312}" (pid=312)&gt; (desktop) of com.apple.finder: AXError.NotificationUnsupported
</code></pre>

<p>Currently these are logged because it&rsquo;s hard to determine if an app <q>should</q> fail
(especially on timeouts). As long as things appear to be working, you can ignore them.</p>
<h2 id='project-status' class='heading'>Project Status</h2>

<p>Swindler is in development and is in <strong>alpha</strong>. Here is the state of its major features:</p>

<ul>
<li>Asynchronous property system: <strong>100% complete</strong></li>
<li>Event system: <strong>100% complete</strong></li>
<li>Window API: <strong>90% complete</strong></li>
<li>Application API: <strong>90% complete</strong></li>
<li>Screen API: <strong>90% complete</strong></li>
<li>Spaces API: <strong>0% complete</strong></li>
</ul>

<p>You can see the entire <a href="https://github.com/tmandry/Swindler/blob/master/API.swift">planned API here</a>.</p>
<h2 id='development' class='heading'>Development</h2>

<p>Swindler uses Cococapods for Dependency management.
<a href="https://guides.cocoapods.org/using/getting-started.html">Follow the instructions</a> to install Cocoapods.
This should give you the <code>pod</code> command for use in the shell.</p>

<p>Clone the project, then in your shell run:</p>
<pre class="highlight plaintext"><code>$ cd Swindler
$ git submodule init
$ git submodule update
$ pod install
</code></pre>

<p>At this point you should be able to build Swindler in Xcode and start on your way!</p>
<h2 id='contact' class='heading'>Contact</h2>

<p>You can chat with us on <a href="https://gitter.im/tmandry/Swindler">Gitter</a>.</p>

<p>Follow me on Twitter: <a href="https://twitter.com/tmandry">@tmandry</a></p>
<h2 id='related-projects' class='heading'>Related Projects</h2>

<ul>
<li><a href="https://github.com/ianyh/Silica">Silica</a></li>
<li><a href="https://github.com/sdegutis/mjolnir">Mjolnir</a></li>
<li><a href="https://github.com/Hammerspoon/hammerspoon">Hammerspoon</a>, a fork of Mjolnir</li>
</ul>

<p>Swindler is built on <a href="https://github.com/tmandry/AXSwift">AXSwift</a>.</p>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2018 <a class="link" href="https://twitter.com/tmandry" target="_blank" rel="external">Tyler Mandry</a>. All rights reserved. (Last updated: 2018-11-18)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.9.4</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
